<div align="center">

# SimCLR

SimCLR implementation with scripts for: self-supervised encoder pretraining, linear evaluation, fine-tuning and transfer learning across multiple datasets.

</div>

## 1. Overview
This repository contains:
- `train_encoder.py`: Pretraining of the encoder.
- `linear_evaluation.py`: Freezes the encoder and trains a linear classifier.
- `transfer_learning.py`: If done in the same dataset as the encoder, a fine-tuning is performed. If not, a transfer learning is performed.
- `configs/*.yaml`: Configs.
- `src/`: Source code.
- `tools/create_datasets.py`: Script to download datasets.

## 2. Steps

In `configs/train_encoder_imagenet` there is an example of pretraining of the encoder where

<pre>
output_path: Output for the results
datasets_path: Datasets folder generated by tools/create_datasets.py
train_datasets: [<dataset>] where dataset is where the encoder will be pre-trained
batch_size: Batch size
num_epochs: Number of epochs
lr: Learning rate
weight_decay: Weight decay
num_workers: num_workers for the dataloader
prefetch_factor: prefetch_factor for the dataloader
model: Model to train the encoder. It can be 'resnet18' or 'resnet50'
transform_resize: [<n>, <n>] where n is the number of pixels to resize the images
projection_head_mode: Projection head mode
temperature: Temperature
projection_dim: Dimension of the latent space of the projection head
warmup_epochs: Warmup epochs
pin_memory: pin_memory for the dataloader
use_checkpoint: True if you want to trade memory efficiency for time eficciency, else False
pretrained: True if you want to use pre-trained weights on model, else False
use_val_subset: True if you want to separate some training data for validation. Util if you want to test hyperparameters
optimizer: Optimizer. It can be 'lars' or 'adamw'
</pre>

The datasets on the <train_datasets> field can be

<pre>
cifar10
cifar100
imagenet
dtd
fgvc-aircraft
flowers-102
food-101
oxford-pets
stanford-cars
tiny-imagenet
caltech-101
</pre>

To run the encoder pre-training, you can run

```
python3 train_encoder.py --config <path_to_config> --gpu <gpu_index>
```
